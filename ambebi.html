<!DOCTYPE html>
<html lang="ka">
<head>
<meta charset="UTF-8">
<title>სიახლეები</title>
<style>
body { font-family: Arial; background:#f4f4f4; padding:20px; }
.news { background:#fff; padding:15px; margin-bottom:15px; border-radius:5px; }
form { background:#fff; padding:15px; margin-bottom:20px; border-radius:5px; }
input, textarea, button { width:100%; margin-top:10px; padding:8px; }
button { background:#007bff; color:#fff; border:none; cursor:pointer; }
small { color:#777; }
</style>
</head>
<body>

<h1>ახალი ამბები</h1>

<!-- ხელით დამატება -->
<form onsubmit="addManualNews(event)">
  <h3>სიახლის დამატება</h3>
  <input id="title" placeholder="სათაური" required>
  <textarea id="content" placeholder="ტექსტი" required></textarea>
  <button>დამატება</button>
</form>

<div id="news"></div>

<script>
const newsBox = document.getElementById("news");
let manualNews = JSON.parse(localStorage.getItem("manualNews")) || [];

/* --- ხელით დამატება --- */
function addManualNews(e) {
  e.preventDefault();
  manualNews.unshift({
    title: title.value,
    description: content.value,
    source: "ავტორის სიახლე",
    date: new Date().toLocaleString("ka-GE")
  });
  localStorage.setItem("manualNews", JSON.stringify(manualNews));
  render();
  title.value = content.value = "";
}

/* --- ავტომატური RSS --- */
const feeds = [
  "https://www.ambebi.ge/rss.xml",
  "https://www.interpressnews.ge/rss"
];

async function loadRSS() {
  let rssNews = [];
  for (let feed of feeds) {
    const res = await fetch(
      "https://api.rss2json.com/v1/api.json?rss_url=" + feed
    );
    const data = await res.json();
    data.items.slice(0,5).forEach(item => {
      rssNews.push({
        title: item.title,
        description: item.description,
        source: data.feed.title,
        date: item.pubDate,
        link: item.link
      });
    });
  }
  return rssNews;
}

/* --- გამოჩენა --- */
async function render() {
  newsBox.innerHTML = "";
  const rssNews = await loadRSS();
  const allNews = [...manualNews, ...rssNews];

  allNews.forEach(n => {
    newsBox.innerHTML += `
      <div class="news">
        <h3>${n.title}</h3>
        <small>${n.source} | ${n.date}</small>
        <p>${n.description}</p>
        ${n.link ? `<a href="${n.link}" target="_blank">სრული ამბავი</a>` : ""}
      </div>
    `;
  });
}

render();
</script>

</body>
</html>
